<!DOCTYPE html>
<html lang="en" data-theme="synthwave">

<head>
    <meta charset="UTF-8" />
    <title>Movie Night Picker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind + daisyUI CDN -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/config.js"></script>

    <!-- Firebase (module) -->
    <script type="module" src="js/firebase-init.js"></script>
</head>

<body class="min-h-screen text-base-content">
    <div class="max-w-5xl mx-auto px-3 py-6 md:py-8 space-y-4 flex flex-col min-h-screen">
        <header
            class="header-shell flex flex-wrap items-center justify-between gap-y-2 px-3 py-3 md:py-4 rounded-2xl border">
            <div class="flex flex-wrap items-center justify-end gap-2">
                <span class="text-2xl font-black tracking-tight">PickMe</span>
            </div>

            <div class="flex items-center gap-2">
                <button id="btnPick" class="btn btn-primary btn-sm sm:btn-md">
                    Pick for me
                </button>
                <span id="roomBadge" class="badge badge-outline hidden">Room: —</span>

                <button id="btnCreateRoom" class="btn btn-outline btn-sm">Create room</button>
                <button id="btnCopyRoomLink" class="btn btn-ghost btn-sm hidden">Copy link</button>
                <button id="btnLeaveRoom" class="btn btn-ghost btn-sm hidden">Leave</button>

                <!-- Theme toggle -->
                <button id="themeToggleBtn" class="theme-toggle btn btn-ghost btn-sm px-2" type="button"
                    title="Toggle theme" aria-label="Toggle theme">
                    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="18" height="18"
                        class="theme-toggle__dark-inner" fill="currentColor" viewBox="0 0 32 32">
                        <path d="M16 9c3.9 0 7 3.1 7 7s-3.1 7-7 7" />
                        <path
                            d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V23c-3.9 0-7-3.1-7-7s3.1-7 7-7V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z" />
                    </svg>
                </button>

                <!-- User/login button with icon -->
                <!-- User menu (dropdown) -->
                <div class="dropdown dropdown-end">
                    <button id="btnUser" tabindex="0" role="button" class="btn btn-ghost btn-sm gap-2">
                        <span id="userChip" class="inline-flex items-center gap-2">
                            <!-- Keep your SVG icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>

                            <!-- NEW: label controlled by JS -->
                            <span id="userChipLabel" class="text-xs opacity-80 hidden sm:inline">Sign in</span>
                        </span>
                    </button>

                    <!-- Make it look like your filter dropdowns -->
                    <ul id="userDropdownMenu" tabindex="0"
                        class="dropdown-content z-50 mt-2 w-64 max-w-[92vw] p-2 rounded-xl border border-base-300 bg-base-100 shadow-xl menu menu-sm">
                        <li class="menu-title"><span>Account</span></li>

                        <li>
                            <button id="btnMenuSignIn" class="flex items-center gap-2 rounded-lg px-3 py-2">
                                <span>Sign in</span>
                            </button>
                        </li>

                        <li>
                            <a href="settings.html" class="flex items-center gap-2 rounded-lg px-3 py-2">
                                <span>Settings</span>
                            </a>
                        </li>

                        <li>
                            <button id="btnMenuCopyUid" class="flex items-center gap-2 rounded-lg px-3 py-2">
                                <span>Copy UID</span>
                            </button>
                        </li>

                        <li class="my-1 border-t border-base-300 opacity-70"></li>

                        <li>
                            <button id="btnMenuSignOut" class="flex items-center gap-2 rounded-lg px-3 py-2 text-error">
                                <span>Sign out</span>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </header>

        <div id="roomPickBanner" class="alert alert-info hidden">
            <span id="roomPickText">Tonight’s pick: —</span>
            <button id="btnOpenPicked" class="btn btn-xs btn-ghost">Open</button>
        </div>

        <main class="grid gap-4 xl:grid-cols-[minmax(0,2fr)_minmax(0,1.1fr)] items-start flex-1 min-h-0">
            <!-- Left: search/results -->
            <section class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body gap-4">
                    <div id="filtersBar" class="flex flex-col gap-3 2xl:flex-row 2xl:flex-nowrap 2xl:items-end">

                        <!-- Row 1: Search input + Search + Trending -->
                        <div id="searchRow" class="flex flex-col md:flex-row gap-2 md:items-end">
                            <div class="flex-1 min-w-0">
                                <label class="label">
                                    <span class="label-text">Search movie</span>
                                </label>
                                <input id="q" class="input input-bordered w-full"
                                    placeholder="Title (or leave empty for rating-based discover)..." />
                            </div>

                            <button id="btnSearch" class="btn btn-secondary ...">Search</button>
                            <button id="btnTrending" class="btn btn-ghost ...">Trending</button>
                        </div>

                        <!-- Row 2: 3 left + 3 right -->
                        <div id="filtersGrid" class="grid grid-cols-1 lg:grid-cols-2 gap-3">

                            <!-- Left column (1/3) -->
                            <div class="flex flex-col gap-2">
                                <select id="mediaType" class="select select-bordered select-sm w-full">
                                    <option value="movie" selected>Movies</option>
                                    <option value="tv">TV Shows</option>
                                </select>
                            </div>

                            <!-- Right column (1/3) -->
                            <div class="flex flex-col gap-2">
                                <div class="dropdown w-full">
                                    <div id="ottDropdownBtn" tabindex="0" role="button"
                                        class="btn btn-outline btn-sm w-full justify-between">
                                        OTT
                                        <span class="opacity-60 text-xs" id="ottDropdownCount"></span>
                                    </div>

                                    <div id="ottDropdownMenu" tabindex="0"
                                        class="dropdown-content z-50 mt-2 w-full p-2 rounded-xl border border-base-300 bg-base-100 shadow-xl max-h-64 overflow-auto">
                                        <label
                                            class="flex items-center gap-2 p-2 rounded-lg hover:bg-base-200/40 cursor-pointer">
                                            <input id="ottNetflix" type="checkbox" class="checkbox checkbox-xs">
                                            <span class="text-sm">Netflix</span>
                                        </label>
                                        <label
                                            class="flex items-center gap-2 p-2 rounded-lg hover:bg-base-200/40 cursor-pointer">
                                            <input id="ottPrime" type="checkbox" class="checkbox checkbox-xs">
                                            <span class="text-sm">Prime Video</span>
                                        </label>
                                        <label
                                            class="flex items-center gap-2 p-2 rounded-lg hover:bg-base-200/40 cursor-pointer">
                                            <input id="ottHotstar" type="checkbox" class="checkbox checkbox-xs">
                                            <span class="text-sm">Disney Hotstar</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Left column (2/3) -->
                            <div class="flex flex-col gap-2">
                                <input id="yearFilter" type="number" class="input input-bordered input-sm w-full"
                                    placeholder="e.g. 2023" min="1900" max="2100" />
                            </div>

                            <!-- Right column (2/3) -->
                            <div class="flex flex-col gap-2">
                                <select id="resultSort" class="select select-bordered select-sm w-full">
                                    <option value="popularity.desc">Popular</option>
                                    <option value="vote_average.desc">Rating</option>
                                    <option value="primary_release_date.desc">Newest</option>
                                </select>
                            </div>

                            <!-- Left column (3/3) -->
                            <div class="flex flex-col gap-2">
                                <div class="dropdown w-full">
                                    <div id="genreDropdownBtn" tabindex="0" role="button"
                                        class="btn btn-outline btn-sm w-full justify-between">
                                        Genres
                                        <span class="opacity-60 text-xs" id="genreDropdownCount"></span>
                                    </div>

                                    <div id="genreDropdownMenu" tabindex="0"
                                        class="dropdown-content z-[50] mt-2 w-full p-2 rounded-xl border border-base-300 bg-base-100 shadow-xl max-h-64 overflow-auto">
                                        <!-- checkboxes injected here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right column (3/3) -->
                        <div class="flex flex-col gap-2">
                            <button id="btnResetFilters" class="btn btn-outline btn-sm w-full">
                                Reset filters
                            </button>
                        </div>
                    </div>
                </div>

                <div id="resultsEmpty" class="text-base-content/60 hidden text-sm">
                    No results yet. Try Trending.
                </div>

                <div id="results" class="grid gap-5"></div>

                <div class="mt-3 flex items-center justify-between gap-2" id="pagerWrap">
                    <button id="btnPrevPage" class="btn btn-sm btn-outline">
                        « Prev
                    </button>

                    <div class="text-xs text-base-content/70">
                        Page <span id="pageCurrent">1</span>
                        of <span id="pageTotal">1</span>
                    </div>

                    <button id="btnNextPage" class="btn btn-sm btn-outline">
                        Next »
                    </button>
                </div>
            </section>

            <!-- Right: pool/filters -->
            <section class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body gap-4">
                    <div class="flex items-center justify-between gap-2">
                        <h2 class="card-title text-base">Your pool</h2>

                        <div class="flex items-center gap-2">
                            <button id="btnImportList" class="btn btn-xs btn-primary hidden">Import</button>

                            <!-- Min rating chip -->
                            <div id="minRatingChip"
                                class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-base-200 text-xs text-base-content/80 border border-base-300">
                                <span class="opacity-80">Min</span>
                                <input id="minRatingPool" type="number" min="0" max="10" step="0.5"
                                    class="w-12 bg-transparent border-none focus:outline-none text-xs text-right"
                                    value="6" />
                            </div>

                            <label id="btnExcludeWatchedPool" class="btn btn-xs btn-primary">
                                <input id="excludeWatched" type="checkbox" class="sr-only" checked />
                                <span>Exclude watched</span>
                            </label>
                            <button id="btnToggleHiddenPool" class="btn btn-xs btn-primary" disabled>
                                Show hidden
                            </button>

                            <button id="btnPickPool" class="btn btn-xs btn-primary">Pick</button>

                            <button id="btnShareList" class="btn btn-xs btn-outline">Share</button>
                            <button id="btnClearPool" class="btn btn-xs btn-ghost">Clear</button>
                        </div>
                    </div>

                    <div id="roomMembersWrap" class="card bg-base-100 shadow-xl border border-base-300 hidden">
                        <div class="card-body gap-3">
                            <div class="flex items-center justify-between">
                                <h3 class="font-bold text-sm">Room members</h3>
                            </div>
                            <div id="roomMembersList" class="space-y-2 text-sm"></div>
                        </div>
                    </div>

                    <!-- Pool + Chat responsive layout -->
                    <div id="poolChatWrap" class="grid grid-cols-1 gap-4 items-start">
                        <!-- Left: pool -->
                        <div>
                            <div id="poolEmpty" class="text-xs text-base-content/60">
                                Add movies from results to build your pool.
                            </div>
                            <div id="pool" class="space-y-2"></div>
                        </div>

                        <!-- Right: chat (hidden until in room) -->
                        <div id="roomChatColumn" class="hidden flex-col gap-2">
                            <div class="flex items-center justify-between text-xs text-base-content/70">
                                <span class="font-semibold">Room chat</span>
                            </div>

                            <div id="roomChatMessages"
                                class="h-48 md:h-64 rounded-xl border border-base-300 bg-base-200/40 overflow-y-auto px-2 py-2 space-y-1 text-xs">
                            </div>

                            <form id="roomChatForm" class="flex items-center gap-2">
                                <input id="roomChatInput" type="text" class="input input-bordered input-xs flex-1"
                                    placeholder="Message everyone…" autocomplete="off" />
                                <button type="submit" class="btn btn-xs btn-primary">Send</button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Details dialog -->
    <dialog id="dlg" class="modal">
        <div class="modal-box max-w-xl">
            <h3 id="dlgTitle" class="font-bold text-lg mb-1"></h3>
            <p id="dlgMeta" class="text-xs text-base-content/70 mb-3"></p>
            <div id="dlgOverview" class="space-y-3"></div>
            <div class="modal-action">
                <button id="btnReroll" class="btn btn-secondary btn-sm hidden">Re-roll</button>
                <button id="btnWatched" class="btn btn-accent btn-sm">Mark watched</button>
                <form method="dialog">
                    <button class="btn btn-sm">Close</button>
                </form>
            </div>
        </div>
    </dialog>

    <dialog id="dlgSettings" class="modal">
        <div class="modal-box max-w-sm space-y-3">
            <h3 class="font-bold text-lg">Settings</h3>

            <button id="btnSettingsToggleTheme" class="btn btn-outline btn-sm w-full">
                Toggle theme
            </button>

            <form method="dialog" class="modal-action">
                <button class="btn btn-sm">Close</button>
            </form>
        </div>
    </dialog>

    <!-- Auth dialog -->
    <dialog id="dlgAuth" class="modal">
        <div class="modal-box max-w-sm space-y-3">
            <h3 class="font-bold text-lg">Sign in</h3>
            <p class="text-sm text-base-content/70">
                Save your movie pool and preferences for this device.
            </p>

            <div class="form-control">
                <label class="label">
                    <span class="label-text text-xs">Name</span>
                </label>
                <input id="authName" type="text" class="input input-bordered input-sm" placeholder="Neo" />
            </div>

            <div class="form-control">
                <label class="label">
                    <span class="label-text text-xs">Email</span>
                </label>
                <input id="authEmail" type="email" class="input input-bordered input-sm"
                    placeholder="you@example.com" />
            </div>

            <div class="form-control">
                <label class="label">
                    <span class="label-text text-xs">Password</span>
                </label>
                <input id="authPass" type="password" class="input input-bordered input-sm" placeholder="••••••••" />
            </div>

            <div class="divider text-xs">or</div>

            <button id="btnGoogleDemo" class="btn btn-outline btn-sm w-full gap-2">
                <span class="text-xs">Continue with Google</span>
            </button>

            <div class="modal-action">
                <button id="btnAuthSubmit" class="btn btn-primary btn-sm">
                    Sign in
                </button>
                <form method="dialog">
                    <button class="btn btn-sm">Cancel</button>
                </form>
            </div>
        </div>
    </dialog>

    <script type="module" src="./js/main.js"></script>
</body>

</html>